{% extends 'base.html' %}

{% macro action_button(index) %}
{% set d = actions[index] %}
<a href="{{ d['uri'] }}" class="button">{{ d.text }}</a>
{% endmacro %}

{% macro link_list(items) %}
<ul class="board">
{% for d in items %}
{% set name_text = d['name_text'] %}
{% set description_text = d['description_text'] %}
{% set asset_uri = d['asset_uri'] %}
{% set video_uri = d['video_uri'] %}
<li>{% if asset_uri %}<a href="{{ asset_uri }}" target="_blank">{% endif %}{{ name_text }}{% if asset_uri %}</a>{% endif %}{% if name_text and description_text %}: {% endif %}{{ description_text }}{% if video_uri %} [<a href="{{ video_uri }}" target="_blank">video</a>]{% endif %}</li>
{% endfor %}
</ul>
{% endmacro %}

{% block head_html %}
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VP9T2V7B17"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag() { dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'G-VP9T2V7B17');
</script>
<title>{{ title_text }}</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="{{ description_text }}">
<style>
body {
  word-wrap: break-word;
}
header {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: space-between;
  margin-bottom: 32px;
}
header > nav {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}
main {
  max-width: 640px;
  margin: auto;
  display: flex;
  gap: 8px;
  flex-direction: column;
}
main > img {
  width: 100%;
}
footer {
  max-width: 640px;
  margin: auto;
  display: flex;
  gap: 8px;
  flex-direction: column;
}
.button {
  padding: 8px;
  border: 0;
  text-decoration: none;
  text-align: center;
  font-size: large;
  background: #17A2F5;
  color: white;
  font-weight: bold;
}
.button:hover {
  cursor: pointer;
}
.board {
  list-style: none;
  padding: 0;
}
.board li:not(:last-child) {
  margin-bottom: 1em;
}
.form {
  display: flex;
  gap: 8px;
  flex-direction: column;
}
.form input {
  font-size: large;
}
#brand {
  height: 1.5em;
  max-width: 100%;
}
#acknowledgments ul {
  display: none;
  gap: 8px;
  flex-wrap: wrap;
}
</style>
{% endblock %}

{% block header_html %}
<nav>
<a href="{{ brand['asset_uri'] }}"><img id="brand" src="{{ brand['image_uri'] }}" loading="lazy"></a>
<a href="#contact">Contact</a>
</nav>
<nav>
<a href="#updates">Updates</a>
<a href="#requests">Requests</a>
<a href="https://crosscompute.net">Automations</a>
</nav>
{% endblock %}

{% block main_html %}
<img src="{{ assets[0].image_uri  }}" loading="lazy">

<section id="summary">
<h1>{{ headline_text }}</h1>
{{ pitch_html | safe }}
</section>

{{ action_button(0) }}

<section>
<h2>What We Do</h2>
{{ summary_html | safe }}
</section>

<div id="newsletter-subscription" class="form">
<label for="v0">Email Address</label>
<input id="v0" class="email_address" type="email" placeholder="you@example.com">
<button type="button" class="button">{{ automations[0].button_text }}</button>
</div>

<section>
<h2>What We Offer</h2>
{{ menu_html | safe }}
</section>

{{ action_button(2) }}

<section id="showcase">
<h2>Browse Our Work</h2>
<h3 id="updates">Updates</h3>
{{ link_list(updates) }}
<h3 id="requests">Requests</h3>
{{ link_list(requests) }}
</section>

{{ action_button(2) }}

<section id="accomplishments">
<h2>Accomplishments</h2>
{{ link_list(accomplishments) }}
</section>
{% endblock %}

{% block footer_html %}
<section id="acknowledgments">
<h2><a href="#acknowledgments">Acknowledgments</a></h2>
{{ link_list(acknowledgments) }}
</section>

<section id="links">
<h2>Links</h2>
{{ link_list(links) }}
</section>

<section id="contact">
<h2>Contact</h2>
{{ link_list(contacts) }}
<div class="calendly-inline-widget" data-url="https://calendly.com/crosscompute/teamwork?hide_event_type_details=1&hide_gdpr_banner=1" style="height:630px"></div>
<script src="https://assets.calendly.com/assets/external/widget.js" async></script>
</section>
{% endblock %}

{% block body_js %}
document.querySelector('#acknowledgments h2 a').onclick = function() {
  this.parentNode.nextElementSibling.style.display = 'flex';
};
const l = document.getElementById('newsletter-subscription');
l.querySelector('button').onclick = function() {
  const d = {
    email_address: { value: l.querySelector('.email_address').value },
  };
  fetch('{{ automations[0].automation_uri }}.json', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(d)});
  l.innerHTML = 'Thank you for subscribing to our monthly newsletter!';
};
{% endblock %}
