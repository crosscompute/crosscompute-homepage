Use defer and maybe async
